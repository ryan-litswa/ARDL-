"0","# Create a data frame to store the results"
"0","okun_results <- data.frame(Country = character(),"
"0","                           Slope = numeric(),"
"0","                           Intercept = numeric(),"
"0","                           R_squared = numeric(),"
"0","                           stringsAsFactors = FALSE)"
"0",""
"0","# Loop over each country to calculate changes and run the regression"
"0","for (country in countries) {"
"0","  # Subset the data for each country"
"0","  country_data <- subset(pdata, Country == country)"
"0","  "
"0","  # Convert country data to a regular data frame to avoid pseries issues"
"0","  country_data <- as.data.frame(country_data)"
"0","  "
"0","  # Calculate the change in unemployment and the GDP growth rate"
"0","  country_data$diff_unemployment <- as.numeric(diff(country_data$Unemployment_Rate))"
"0","  country_data$gdp_growth_rate <- 100 * diff(log(country_data$GDP))  # Calculate GDP growth rate in percentage form"
"0","  "
"0","  # Remove NA values that result from differencing"
"0","  country_data <- na.omit(country_data)"
"0","  "
"0","  # Run the linear regression (Change in Unemployment Rate ~ GDP Growth Rate)"
"0","  okun_model <- lm(diff_unemployment ~ gdp_growth_rate, data = country_data)"
"0","  "
"0","  # Extract the regression results"
"0","  slope <- coef(okun_model)[2]"
"0","  intercept <- coef(okun_model)[1]"
"0","  r_squared <- summary(okun_model)$r.squared"
"0","  "
"0","  # Store the results in the data frame"
"0","  okun_results <- rbind(okun_results, data.frame(Country = country,"
"0","                                                 Slope = slope,"
"0","                                                 Intercept = intercept,"
"0","                                                 R_squared = r_squared))"
"0","  "
"0","  # Create a scatter plot with a regression line"
"0","  plot <- ggplot(country_data, aes(x = gdp_growth_rate, y = diff_unemployment)) +"
"0","    geom_point(color = ""red"") +"
"0","    geom_smooth(method = ""lm"", se = FALSE, color = ""black"") +"
"0","    labs(title = paste(""Okun's Law for"", country),"
"0","         x = ""GDP Growth Rate (%)"","
"0","         y = ""Change in Unemployment Rate"","
"0","         caption = paste(""R-squared:"", round(r_squared, 2))) +"
"0","    theme_minimal() +"
"0","    scale_x_continuous(labels = scales::percent_format(scale = 1))  # Format X-axis as percentage"
"0","  "
"0","  # Print the plot for each country"
"0","  print(plot)"
"0","}"
